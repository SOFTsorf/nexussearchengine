<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyStream - Powered by API</title>
    <style>
        :root {
            --spotify-green: #1DB954;
            --bg-black: #121212;
            --sidebar-black: #000000;
            --text-white: #ffffff;
            --text-gray: #b3b3b3;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-black);
            color: var(--text-white);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-container { display: flex; flex: 1; overflow: hidden; }

        nav {
            width: 240px;
            background-color: var(--sidebar-black);
            padding: 20px;
        }

        main {
            flex: 1;
            background: linear-gradient(to bottom, #222, #121212);
            padding: 30px;
            overflow-y: auto;
        }

        .song-list { width: 100%; border-collapse: collapse; }
        .song-list th, .song-list td { text-align: left; padding: 12px; border-bottom: 1px solid #282828; }
        .song-row:hover { background-color: rgba(255,255,255,0.1); cursor: pointer; }

        .player-bar {
            height: 100px;
            background-color: #181818;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-top: 1px solid #282828;
        }

        .controls { display: flex; flex-direction: column; align-items: center; width: 40%; }
        .btn-play { background: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 20px; }
        
        input[type="range"] { width: 100%; accent-color: var(--spotify-green); }
        
        .loader { color: var(--spotify-green); font-weight: bold; }
    </style>
</head>
<body>

<div class="main-container">
    <nav>
        <h2 style="color: var(--spotify-green)">MyStream API</h2>
        <p style="color: var(--text-gray)">Entdecke freie Musik</p>
    </nav>

    <main>
        <h1>Aktuelle Charts (Jamendo API)</h1>
        <div id="status" class="loader">Lade Songs...</div>
        <table class="song-list">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Titel</th>
                    <th>KÃ¼nstler</th>
                    <th>Abspielen</th>
                </tr>
            </thead>
            <tbody id="playlist-body"></tbody>
        </table>
    </main>
</div>

<div class="player-bar">
    <div style="width: 30%">
        <strong id="track-title">Kein Song gewÃ¤hlt</strong><br>
        <small id="track-artist" style="color: var(--text-gray);"></small>
    </div>

    <div class="controls">
        <button class="btn-play" id="playBtn" onclick="togglePlay()">â–¶</button>
        <input type="range" id="progress-bar" value="0">
    </div>

    <div style="width: 30%; text-align: right;">
        ðŸ”Š <input type="range" id="volume-slider" value="70" style="width: 80px;">
    </div>
</div>

<audio id="audio-player"></audio>

<script>
    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('playBtn');
    const progressBar = document.getElementById('progress-bar');
    const playlistBody = document.getElementById('playlist-body');
    
    let songs = [];

    // 1. DATEN VON API LADEN
    async function fetchSongs() {
        const client_id = '55d85e78'; // Dies ist ein Test-Key fÃ¼r Jamendo
        const url = `https://api.jamendo.com/v3.0/tracks/?client_id=${client_id}&format=jsonfull&limit=15&order=popularity_week`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            songs = data.results;
            renderPlaylist();
            document.getElementById('status').innerText = "";
        } catch (error) {
            document.getElementById('status').innerText = "Fehler beim Laden der Musik.";
            console.error(error);
        }
    }

    // 2. PLAYLIST ANZEIGEN
    function renderPlaylist() {
        playlistBody.innerHTML = "";
        songs.forEach((song, index) => {
            const row = document.createElement('tr');
            row.classList.add('song-row');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${song.name}</td>
                <td>${song.artist_name}</td>
                <td>â–¶</td>
            `;
            row.onclick = () => loadSong(index);
            playlistBody.appendChild(row);
        });
    }

    // 3. LOGIK
    function loadSong(index) {
        const song = songs[index];
        audio.src = song.audio; // Die API liefert uns direkt die MP3-URL
        document.getElementById('track-title').innerText = song.name;
        document.getElementById('track-artist').innerText = song.artist_name;
        audio.play();
        playBtn.innerText = "â¸";
    }

    function togglePlay() {
        if (audio.paused) {
            audio.play();
            playBtn.innerText = "â¸";
        } else {
            audio.pause();
            playBtn.innerText = "â–¶";
        }
    }

    audio.ontimeupdate = () => {
        progressBar.value = (audio.currentTime / audio.duration) * 100 || 0;
    };

    progressBar.oninput = () => {
        audio.currentTime = (progressBar.value / 100) * audio.duration;
    };

    document.getElementById('volume-slider').oninput = (e) => {
        audio.volume = e.target.value / 100;
    };

    // Initialisierung
    fetchSongs();
</script>

</body>
</html>
