<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spotify Clone Pro</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');

        :root {
            --spotify-green: #1ed760;
            --bg-base: #121212;
            --bg-elevated: #242424;
            --text-base: #ffffff;
            --text-subdued: #a7a7a7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-base);
            color: var(--text-base);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- NAVIGATION BOTTOM --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 65px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 50;
            border-top: 1px solid #222;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-subdued);
            font-size: 10px;
            cursor: pointer;
            transition: color 0.2s;
            width: 33%;
        }
        .nav-item.active { color: var(--text-base); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: currentColor; }

        /* --- VIEWS --- */
        .view {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-top: 40px;
            padding-bottom: 140px; /* Platz für Nav + Miniplayer */
            display: none;
            background: linear-gradient(to bottom, #2a2a2a 0%, var(--bg-base) 200px);
        }
        .view.active { display: block; }

        h1 { font-size: 24px; font-weight: 700; margin-bottom: 20px; }

        /* --- SEARCH & ADD FORM --- */
        .search-container input {
            width: 100%;
            padding: 14px 40px;
            border-radius: 4px;
            border: none;
            background: #fff;
            color: #000;
            font-size: 14px;
            font-family: inherit;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .add-form { background: var(--bg-elevated); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .add-form input { width: 100%; padding: 12px; border-radius: 4px; border: none; background: #333; color: white; margin-bottom: 10px; font-family: inherit;}
        .add-form button { background: var(--text-base); color: black; border: none; padding: 12px; border-radius: 20px; font-weight: bold; width: 100%; cursor: pointer; }

        /* --- TRACK LIST --- */
        .track-item { display: flex; align-items: center; margin-bottom: 16px; cursor: pointer; }
        .track-item img { width: 48px; height: 48px; object-fit: cover; border-radius: 4px; margin-right: 12px; }
        .track-info { flex: 1; overflow: hidden; }
        .track-title { font-size: 16px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-artist { font-size: 13px; color: var(--text-subdued); margin-top: 4px; }
        .track-options { padding: 10px; color: var(--text-subdued); }

        /* --- MINI PLAYER --- */
        .mini-player {
            position: fixed;
            bottom: 70px;
            left: 10px;
            right: 10px;
            height: 56px;
            background: #404040;
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding: 8px;
            z-index: 60;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            display: none; /* Erst zeigen wenn was spielt */
        }
        .mini-player img { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }
        .mini-info { flex: 1; margin: 0 10px; overflow: hidden; }
        .mini-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .mini-artist { font-size: 12px; color: var(--text-subdued); }
        .mini-controls { display: flex; align-items: center; gap: 15px; padding-right: 10px; }
        .mini-play-btn { width: 24px; height: 24px; fill: white; }

        /* --- FULL SCREEN PLAYER (EXAKT WIE SCREENSHOT) --- */
        .full-player {
            position: fixed;
            top: 100%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #121212;
            z-index: 100;
            transition: top 0.3s ease-out;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }
        .full-player.active { top: 0; }
        
        /* Unscharfer Hintergrund basierend auf Thumbnail */
        .fp-bg {
            position: absolute;
            top: -20%; left: -20%; width: 140%; height: 140%;
            background-image: url('https://via.placeholder.com/10');
            background-size: cover;
            background-position: center;
            filter: blur(60px) brightness(0.4);
            z-index: -1;
        }

        .fp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .fp-header svg { width: 24px; height: 24px; fill: white; cursor: pointer; }
        .fp-header-text { text-align: center; font-size: 11px; letter-spacing: 1px; color: white; }
        .fp-header-text b { display: block; font-size: 13px; margin-top: 2px; }

        /* Das Video im Vollbild-Player */
        .fp-video-container {
            width: 100%;
            aspect-ratio: 1 / 1; /* Quadratisch wie ein Album Cover */
            margin-top: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            background: #000;
        }
        .fp-video-container iframe { width: 100%; height: 100%; pointer-events: none; /* Verhindert Klicks ins YT Video */ }

        .fp-track-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 40px;
        }
        .fp-title { font-size: 24px; font-weight: 700; margin: 0; }
        .fp-artist { font-size: 16px; color: var(--text-subdued); margin: 5px 0 0 0; }
        .fp-check { width: 24px; height: 24px; fill: var(--spotify-green); }

        /* Progress Bar */
        .fp-progress-container { margin-top: 25px; }
        .fp-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }
        .fp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px; height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }
        .fp-time {
            display: flex; justify-content: space-between;
            font-size: 11px; color: var(--text-subdued); margin-top: 8px; font-variant-numeric: tabular-nums;
        }

        /* Controls */
        .fp-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .fp-controls svg { fill: white; width: 24px; height: 24px; cursor: pointer; }
        .fp-controls .play-pause {
            width: 64px; height: 64px;
            background: white;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
        }
        .fp-controls .play-pause svg { fill: black; width: 28px; height: 28px; }

        .fp-bottom-icons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            margin-bottom: 20px;
        }
        .fp-bottom-icons svg { fill: var(--text-subdued); width: 20px; height: 20px; }
        .fp-bottom-icons span { font-size: 11px; color: var(--text-subdued); font-weight: 600; display: flex; align-items: center; gap: 5px;}

    </style>
</head>
<body>

    <div id="view-home" class="view active">
        <h1>Guten Abend</h1>
        <div id="home-recent"></div>
    </div>

    <div id="view-search" class="view">
        <h1>Suchen</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Was möchtest du hören?" oninput="filterLibrary()">
        </div>
        <div id="search-results"></div>
    </div>

    <div id="view-library" class="view">
        <h1>Deine Bibliothek</h1>
        
        <div class="add-form">
            <h3 style="margin-top:0; font-size:14px;">Song hinzufügen</h3>
            <input type="text" id="newTitle" placeholder="Song Titel">
            <input type="text" id="newArtist" placeholder="Künstler">
            <input type="text" id="newYtId" placeholder="YouTube Video ID (z.B. dQw4w9WgXcQ)">
            <button onclick="addSong()">Zur Bibliothek hinzufügen</button>
        </div>

        <div id="library-list"></div>
    </div>

    <div class="mini-player" id="miniPlayer" onclick="openPlayer()">
        <img id="mini-img" src="">
        <div class="mini-info">
            <div class="mini-title" id="mini-title">Titel</div>
            <div class="mini-artist" id="mini-artist">Artist</div>
        </div>
        <div class="mini-controls">
            <svg id="mini-play-btn" onclick="togglePlay(event)" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
    </div>

    <div class="full-player" id="fullPlayer">
        <div class="fp-bg" id="fp-bg"></div>
        
        <div class="fp-header">
            <svg onclick="closePlayer()" viewBox="0 0 24 24"><path d="M15.957 2.793a1 1 0 010 1.414L8.164 12l7.793 7.793a1 1 0 11-1.414 1.414L5.336 12l9.207-9.207a1 1 0 011.414 0z" transform="rotate(-90 12 12)"/></svg>
            <div class="fp-header-text">WIEDERGABE AUS PLAYLIST<b id="fp-context">Deine Bibliothek</b></div>
            <svg viewBox="0 0 24 24"><path d="M12 3a2 2 0 100 4 2 2 0 000-4zm0 7a2 2 0 100 4 2 2 0 000-4zm0 7a2 2 0 100 4 2 2 0 000-4z"/></svg>
        </div>

        <div class="fp-video-container">
            <div id="yt-player-placeholder"></div>
        </div>

        <div class="fp-track-info">
            <div>
                <h2 class="fp-title" id="fp-title">Titel</h2>
                <p class="fp-artist" id="fp-artist">Artist</p>
            </div>
            <svg class="fp-check" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor"/><path d="M10 16l-4-4 1.41-1.41L10 13.17l6.59-6.59L18 8l-8 8z" fill="#000"/></svg>
        </div>

        <div class="fp-progress-container">
            <input type="range" class="fp-slider" id="fp-slider" value="0" min="0" max="100" onchange="seekTo(this.value)">
            <div class="fp-time">
                <span id="fp-time-current">0:00</span>
                <span id="fp-time-total">0:00</span>
            </div>
        </div>

        <div class="fp-controls">
            <svg viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
            <svg onclick="prevTrack()" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            
            <div class="play-pause" onclick="togglePlay(event)">
                <svg id="fp-play-btn" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
            
            <svg onclick="nextTrack()" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
            <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
        </div>

        <div class="fp-bottom-icons">
            <span><svg viewBox="0 0 24 24"><path d="M2 12A10 10 0 1022 12 10 10 0 002 12zm8 4h-2v-8h2v8zm4 0h-2v-6h2v6z"/></svg> Lossless</span>
            <div style="display:flex; gap:20px;">
                <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>
                <svg viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h12v2H4z"/></svg>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchView('home', this)">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            Home
        </div>
        <div class="nav-item" onclick="switchView('search', this)">
            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            Suche
        </div>
        <div class="nav-item" onclick="switchView('library', this)">
            <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12zM10 9h8v2h-8zm0 3h4v2h-4zm0-6h8v2h-8z"/></svg>
            Bibliothek
        </div>
    </div>

<script>
    // --- DATEN & STATE ---
    let myLibrary = JSON.parse(localStorage.getItem('spotify_clone_lib')) || [
        { title: "Anchor", artist: "Alex Baker, Hanging Valleys", ytId: "9oD5M_yN1H0" }, // Mock basierend auf Screenshot
        { title: "Blinding Lights", artist: "The Weeknd", ytId: "4NRXx6U8ABQ" },
        { title: "Lofi Hip Hop Radio", artist: "Lofi Girl", ytId: "jfKfPfyJRdk" }
    ];

    let currentTrackIndex = 0;
    let ytPlayer;
    let isPlaying = false;
    let progressInterval;

    const playIcon = '<path d="M8 5v14l11-7z"/>';
    const pauseIcon = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';

    // --- INITIALISIERUNG YOUTUBE API ---
    function onYouTubeIframeAPIReady() {
        ytPlayer = new YT.Player('yt-player-placeholder', {
            height: '100%',
            width: '100%',
            videoId: myLibrary[0].ytId,
            playerVars: { 
                'autoplay': 0, 'controls': 0, 'disablekb': 1, 
                'fs': 0, 'modestbranding': 1, 'rel': 0, 'playsinline': 1 
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        renderLists();
    }

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            isPlaying = true;
            updatePlayButtons(pauseIcon);
            startProgressBar();
            
            // Lade Gesamtlänge
            const duration = ytPlayer.getDuration();
            document.getElementById('fp-slider').max = duration;
            document.getElementById('fp-time-total').innerText = formatTime(duration);
        } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) {
            isPlaying = false;
            updatePlayButtons(playIcon);
            clearInterval(progressInterval);
            if(event.data == YT.PlayerState.ENDED) nextTrack();
        }
    }

    // --- UI FUNKTIONEN ---
    function switchView(viewId, element) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        element.classList.add('active');
    }

    function renderLists() {
        renderList('library-list', myLibrary);
        renderList('home-recent', myLibrary.slice(0, 5)); // Zeige max 5 auf Home
        filterLibrary(); // Für Suche
    }

    function renderList(containerId, tracks) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        tracks.forEach((track, index) => {
            const realIndex = myLibrary.findIndex(t => t.ytId === track.ytId);
            const imgUrl = `https://img.youtube.com/vi/${track.ytId}/hqdefault.jpg`;
            container.innerHTML += `
                <div class="track-item" onclick="loadTrack(${realIndex})">
                    <img src="${imgUrl}">
                    <div class="track-info">
                        <div class="track-title">${track.title}</div>
                        <div class="track-artist">${track.artist}</div>
                    </div>
                    <div class="track-options">⋮</div>
                </div>
            `;
        });
    }

    function filterLibrary() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = myLibrary.filter(t => t.title.toLowerCase().includes(query) || t.artist.toLowerCase().includes(query));
        renderList('search-results', filtered);
    }

    function addSong() {
        const title = document.getElementById('newTitle').value;
        const artist = document.getElementById('newArtist').value;
        const ytId = document.getElementById('newYtId').value;
        
        if(title && artist && ytId) {
            myLibrary.push({ title, artist, ytId });
            localStorage.setItem('spotify_clone_lib', JSON.stringify(myLibrary));
            renderLists();
            
            // Felder leeren
            document.getElementById('newTitle').value = "";
            document.getElementById('newArtist').value = "";
            document.getElementById('newYtId').value = "";
            alert("Erfolgreich hinzugefügt!");
        }
    }

    // --- PLAYER LOGIK ---
    function loadTrack(index) {
        currentTrackIndex = index;
        const track = myLibrary[index];
        const imgUrl = `https://img.youtube.com/vi/${track.ytId}/hqdefault.jpg`;

        // UI Update Mini Player
        document.getElementById('miniPlayer').style.display = 'flex';
        document.getElementById('mini-title').innerText = track.title;
        document.getElementById('mini-artist').innerText = track.artist;
        document.getElementById('mini-img').src = imgUrl;

        // UI Update Full Player
        document.getElementById('fp-title').innerText = track.title;
        document.getElementById('fp-artist').innerText = track.artist;
        document.getElementById('fp-bg').style.backgroundImage = `url('${imgUrl}')`; // Unscharfer Hintergrund

        // YouTube Video laden & starten
        if(ytPlayer && ytPlayer.loadVideoById) {
            ytPlayer.loadVideoById(track.ytId);
        }
    }

    function togglePlay(event) {
        if(event) event.stopPropagation();
        if(!ytPlayer || !ytPlayer.getPlayerState) return;

        const state = ytPlayer.getPlayerState();
        if (state == YT.PlayerState.PLAYING) {
            ytPlayer.pauseVideo();
        } else {
            ytPlayer.playVideo();
        }
    }

    function nextTrack() {
        let next = currentTrackIndex + 1;
        if(next >= myLibrary.length) next = 0;
        loadTrack(next);
    }

    function prevTrack() {
        let prev = currentTrackIndex - 1;
        if(prev < 0) prev = myLibrary.length - 1;
        loadTrack(prev);
    }

    function updatePlayButtons(svgPath) {
        document.getElementById('mini-play-btn').innerHTML = svgPath;
        document.getElementById('fp-play-btn').innerHTML = svgPath;
    }

    // --- PROGRESS BAR & TIME ---
    function startProgressBar() {
        clearInterval(progressInterval);
        progressInterval = setInterval(() => {
            if(ytPlayer && ytPlayer.getCurrentTime) {
                const currentTime = ytPlayer.getCurrentTime();
                document.getElementById('fp-slider').value = currentTime;
                document.getElementById('fp-time-current').innerText = formatTime(currentTime);
            }
        }, 500); // Update alle 500ms
    }

    function seekTo(seconds) {
        if(ytPlayer && ytPlayer.seekTo) {
            ytPlayer.seekTo(seconds, true);
        }
    }

    function formatTime(timeInSeconds) {
        timeInSeconds = Math.round(timeInSeconds);
        const minutes = Math.floor(timeInSeconds / 60);
        const seconds = timeInSeconds % 60;
        return minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
    }

    // --- ANIMATIONEN ---
    function openPlayer() {
        document.getElementById('fullPlayer').classList.add('active');
    }

    function closePlayer() {
        document.getElementById('fullPlayer').classList.remove('active');
    }

    // Start
    renderLists();
</script>
</body>
</html>
