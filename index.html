<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spotify Clone Pro</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');

        :root {
            --spotify-green: #1ed760;
            --bg-base: #121212;
            --bg-elevated: #242424;
            --bg-highlight: #2a2a2a;
            --text-base: #ffffff;
            --text-subdued: #a7a7a7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-base);
            color: var(--text-base);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER & CHIPS --- */
        .top-header { display: flex; align-items: center; padding: 15px 15px 10px; gap: 10px; position: sticky; top: 0; background: var(--bg-base); z-index: 10; }
        .profile-icon { width: 32px; height: 32px; background: #e0f2f1; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: black; font-weight: bold; font-size: 14px; flex-shrink: 0; }
        .top-header h1 { font-size: 22px; font-weight: 700; flex: 1; letter-spacing: -0.5px; }
        .header-icons { display: flex; gap: 20px; align-items: center; }
        .header-icons svg { fill: white; width: 24px; height: 24px; cursor: pointer; }

        .chip-container { display: flex; gap: 8px; padding: 0 15px 15px; overflow-x: auto; scrollbar-width: none; background: var(--bg-base); position: sticky; top: 57px; z-index: 10; align-items: center; }
        .chip-container::-webkit-scrollbar { display: none; }
        .chip { background: var(--bg-highlight); color: var(--text-base); padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; font-weight: 600; border: 1px solid transparent; transition: background 0.2s; }
        .chip.active { background: var(--spotify-green); color: black; }

        /* --- VIEWS --- */
        .view { flex: 1; overflow-y: auto; padding-bottom: 140px; display: none; }
        .view.active { display: block; }

        /* --- START VIEW --- */
        .start-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 15px 25px; }
        .grid-item { background: rgba(255,255,255,0.1); border-radius: 4px; display: flex; align-items: center; overflow: hidden; cursor: pointer; transition: background 0.2s; height: 56px; }
        .grid-item:active { background: rgba(255,255,255,0.2); }
        .grid-item img { width: 56px; height: 56px; object-fit: cover; box-shadow: 2px 0 5px rgba(0,0,0,0.2); }
        .grid-item span { padding: 0 10px; font-size: 12px; font-weight: 700; flex: 1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.2; }

        .feed-section { padding: 0 15px 20px; }
        .feed-item { margin-bottom: 25px; }
        .feed-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .feed-header img { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
        .feed-header-info h4 { font-size: 15px; font-weight: 700; margin-bottom: 2px; }
        .feed-header-info p { font-size: 13px; color: var(--text-subdued); }
        .feed-content { background: #181818; border-radius: 8px; overflow: hidden; padding-bottom: 15px; }
        .feed-content img { width: 100%; height: auto; aspect-ratio: 16/9; object-fit: cover; }
        .feed-title { font-size: 18px; font-weight: 700; padding: 12px 15px 5px; line-height: 1.3; }
        .feed-subtitle { font-size: 14px; color: var(--text-subdued); padding: 0 15px; }
        .feed-actions { display: flex; justify-content: space-between; align-items: center; padding: 15px 15px 0; }
        .feed-actions-left { display: flex; gap: 15px; }
        .feed-actions-left svg { width: 24px; height: 24px; fill: var(--text-subdued); cursor: pointer; }
        .feed-play-btn { background: white; width: 32px; height: 32px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .feed-play-btn svg { fill: black; width: 18px; height: 18px; }

        /* --- LIBRARY VIEW --- */
        .sort-bar { padding: 0 15px 10px; font-size: 13px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; color: var(--text-base); }
        .sort-left { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .sort-left svg { width: 16px; height: 16px; fill: currentColor; }
        .sort-right svg { width: 18px; height: 18px; fill: currentColor; cursor: pointer; }
        
        .list-item { display: flex; align-items: center; padding: 8px 15px; cursor: pointer; }
        .list-item:active { background: #222; }
        .list-item img { width: 64px; height: 64px; object-fit: cover; margin-right: 15px; }
        .list-item.round img { border-radius: 50%; }
        .list-item.square img { border-radius: 4px; }
        .list-info { flex: 1; overflow: hidden; }
        .list-title { font-size: 16px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; color: var(--text-base); }
        .list-title.green { color: var(--spotify-green); }
        .list-subtitle { font-size: 13px; color: var(--text-subdued); display: flex; align-items: center; gap: 5px; }
        .pin-icon { width: 12px; height: 12px; fill: var(--spotify-green); transform: rotate(45deg); }

        /* --- SEARCH VIEW --- */
        .search-container { padding: 15px; }
        .search-container input { width: 100%; padding: 12px 40px; border-radius: 4px; border: none; background: #fff; color: #000; font-size: 14px; font-weight: 600; }
        .search-results-section { padding: 0 15px; margin-bottom: 20px; }
        .search-results-section h3 { font-size: 16px; margin-bottom: 15px; font-weight: 700; }

        /* --- NAVIGATION BOTTOM --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: rgba(18,18,18,0.95); display: flex; justify-content: space-around; align-items: center; z-index: 50; padding-bottom: 5px; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-subdued); font-size: 10px; cursor: pointer; transition: color 0.2s; width: 33.33%; margin-top: 5px; font-weight: 600; }
        .nav-item.active { color: var(--text-base); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: currentColor; }

        /* --- MINI PLAYER --- */
        .mini-player { position: fixed; bottom: 70px; left: 8px; right: 8px; height: 56px; background: #2a2a2a; border-radius: 6px; display: flex; align-items: center; padding: 8px; z-index: 60; box-shadow: 0 4px 12px rgba(0,0,0,0.5); display: none; cursor: pointer; }
        .mini-player img { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }
        .mini-info { flex: 1; margin: 0 10px; overflow: hidden; }
        .mini-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .mini-artist { font-size: 12px; color: var(--text-subdued); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .mini-controls { display: flex; align-items: center; gap: 15px; padding-right: 10px; }
        .mini-play-btn { width: 24px; height: 24px; fill: white; }

        /* --- FULL SCREEN PLAYER (Unberührt, nur minimales CSS Framing fürs Layout beibehalten) --- */
        .full-player { position: fixed; top: 100%; left: 0; width: 100%; height: 100%; background-color: var(--bg-base); z-index: 100; transition: top 0.3s ease-out; display: flex; flex-direction: column; padding: 20px; overflow: hidden; }
        .full-player.active { top: 0; }
        .fp-bg { position: absolute; top: -20%; left: -20%; width: 140%; height: 140%; background-size: cover; background-position: center; filter: blur(60px) brightness(0.4); z-index: -1; }
        .fp-header { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .fp-header svg { width: 24px; height: 24px; fill: white; cursor: pointer; }
        .fp-header-text { text-align: center; font-size: 11px; letter-spacing: 1px; color: white; }
        .fp-header-text b { display: block; font-size: 13px; margin-top: 2px; }
        
        .fp-image-container { width: 100%; aspect-ratio: 1 / 1; margin-top: 30px; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); background: #000; position: relative; }
        .fp-image-container img { width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; z-index: 1; pointer-events:none; }
        #yt-player-placeholder { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 2; opacity: 1; transition: opacity 0.3s; }
        
        .video-toggle-pill { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; z-index: 10; display: none; }

        .fp-track-info { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 40px; }
        .fp-title { font-size: 24px; font-weight: 700; margin: 0; }
        .fp-artist { font-size: 16px; color: var(--text-subdued); margin: 5px 0 0 0; }
        .fp-check { width: 24px; height: 24px; fill: var(--spotify-green); }

        .fp-progress-container { margin-top: 25px; }
        .fp-slider { -webkit-appearance: none; width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; outline: none; }
        .fp-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: white; border-radius: 50%; cursor: pointer; }
        .fp-time { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-subdued); margin-top: 8px; font-variant-numeric: tabular-nums; }

        .fp-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .fp-controls svg { fill: white; width: 24px; height: 24px; cursor: pointer; }
        .fp-controls .play-pause { width: 64px; height: 64px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .fp-controls .play-pause svg { fill: black; width: 28px; height: 28px; }

        /* --- BOTTOM SHEET MENU (PLUS MENU) --- */
        .bottom-sheet-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 200; opacity: 0; transition: opacity 0.3s; }
        .bottom-sheet-overlay.active { display: block; opacity: 1; }
        .bottom-sheet { position: absolute; bottom: 0; left: 0; width: 100%; background: #282828; border-radius: 24px 24px 0 0; padding: 5px 20px 30px; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.1, 0.9, 0.2, 1); }
        .bottom-sheet.active { transform: translateY(0); }
        .bs-handle { width: 36px; height: 4px; background: #666; border-radius: 2px; margin: 10px auto 25px; }
        .bs-item { display: flex; align-items: center; gap: 15px; padding: 12px 0; cursor: pointer; }
        .bs-icon { background: #3e3e3e; border-radius: 50%; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .bs-icon svg { width: 26px; height: 26px; fill: white; }
        .bs-text h4 { margin: 0; font-size: 16px; font-weight: 600; color: white; margin-bottom: 2px; }
        .bs-text p { margin: 0; font-size: 13px; color: var(--text-subdued); line-height: 1.4; }

        /* --- CREATE PLAYLIST FULLSCREEN --- */
        .create-playlist-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, #4a4a4a 0%, #121212 100%); z-index: 250; display: none; flex-direction: column; opacity: 0; transition: opacity 0.3s; justify-content: center; align-items: center; }
        .create-playlist-screen.active { display: flex; opacity: 1; }
        .cp-header { text-align: center; font-size: 28px; font-weight: 700; margin-bottom: 50px; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .cp-input-container { text-align: center; width: 100%; padding: 0 40px; }
        .cp-input { font-family: inherit; font-size: 36px; font-weight: 700; text-align: center; background: transparent; border: none; border-bottom: 1px solid #777; color: white; outline: none; padding-bottom: 8px; width: 100%; }
        .cp-input:focus { border-bottom: 2px solid var(--spotify-green); }
        .cp-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 60px; }
        .cp-btn-cancel { background: transparent; border: 1px solid #888; color: white; border-radius: 30px; padding: 14px 32px; font-size: 15px; font-weight: 700; cursor: pointer; }
        .cp-btn-create { background: var(--spotify-green); border: none; color: black; border-radius: 30px; padding: 14px 32px; font-size: 15px; font-weight: 700; cursor: pointer; }

        /* --- SPOTIFY STYLE POPUP --- */
        .popup-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 300; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.2s; }
        .popup-overlay.active { display: flex; opacity: 1; }
        .popup-box { background: #f0f0f0; color: black; border-radius: 12px; width: 85%; max-width: 340px; padding: 25px 20px 15px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.7); transform: scale(0.9); transition: transform 0.2s; }
        .popup-overlay.active .popup-box { transform: scale(1); }
        .popup-title { margin: 0 0 12px 0; font-size: 18px; font-weight: 700; }
        .popup-text { margin: 0 0 25px 0; font-size: 14px; color: #333; line-height: 1.5; padding: 0 10px; font-weight: 600; }
        .popup-btn-primary { background: var(--spotify-green); color: black; border: none; padding: 14px 20px; border-radius: 30px; font-size: 15px; font-weight: 700; cursor: pointer; display: block; width: 100%; margin-bottom: 5px; }
        .popup-btn-secondary { background: transparent; color: black; border: none; padding: 14px 20px; font-size: 15px; font-weight: 700; cursor: pointer; width: 100%; }

    </style>
</head>
<body>

    <audio id="native-audio" style="display:none;"></audio>

    <div id="view-start" class="view active">
        <div class="top-header">
            <div class="profile-icon">XX</div>
            <div class="chip-container" style="position:static; padding:0; flex:1;">
                <span class="chip active">Alle</span>
                <span class="chip">Musik</span>
                <span class="chip">Podcasts</span>
                <span class="chip">Hörbücher</span>
            </div>
        </div>

        <div class="start-grid" id="start-grid-container">
            </div>

        <div class="feed-section" id="recommendations-container">
            </div>
    </div>

    <div id="view-search" class="view">
        <div class="top-header">
            <div class="profile-icon">XX</div>
            <h1>Suchen</h1>
        </div>
        <div class="search-container">
            <div style="position:relative;">
                <svg style="position:absolute; left:12px; top:12px; width:20px; height:20px; fill:#000;" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                <input type="text" id="searchInput" placeholder="Was möchtest du hören?" oninput="performSearch()">
            </div>
        </div>
        
        <div class="search-results-section">
            <h3>Deine Bibliothek</h3>
            <div id="search-local-results"></div>
        </div>

        <div class="search-results-section">
            <h3>Podcasts (iTunes API)</h3>
            <div id="search-itunes-results" style="color:var(--text-subdued); font-size:13px;">Tippe etwas ein, um weltweite Podcasts zu suchen...</div>
        </div>
    </div>

    <div id="view-library" class="view">
        <div class="top-header">
            <div class="profile-icon">XX</div>
            <h1>Bibliothek</h1>
            <div class="header-icons">
                <svg onclick="switchView('search')" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                <svg onclick="openPlusMenu()" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </div>
        </div>

        <div class="chip-container">
            <span class="chip">Playlists</span>
            <span class="chip">Podcasts</span>
            <span class="chip">Künstler*innen</span>
            <span class="chip">Heruntergelade...</span>
        </div>
        
        <div class="sort-bar">
            <div class="sort-left">
                <svg viewBox="0 0 16 16"><path d="M8 0L2 6h4v10h4V6h4L8 0z" transform="scale(0.8) translate(2,2)"/></svg>
                <span>Zuletzt</span>
            </div>
            <div class="sort-right">
                <svg viewBox="0 0 24 24"><path d="M3 3h7v7H3V3zm11 0h7v7h-7V3zm0 11h7v7h-7v-7zm-11 0h7v7H3v-7z"/></svg>
            </div>
        </div>
        
        <div id="library-list"></div>
    </div>

    <div class="mini-player" id="miniPlayer" onclick="openPlayer()">
        <img id="mini-img" src="">
        <div class="mini-info">
            <div class="mini-title" id="mini-title">Titel</div>
            <div class="mini-artist" id="mini-artist">Artist</div>
        </div>
        <div class="mini-controls">
            <svg viewBox="0 0 24 24" style="fill:var(--spotify-green); width:22px; height:22px;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            <svg id="mini-play-btn" onclick="togglePlay(event)" viewBox="0 0 24 24" class="mini-play-btn"><path d="M8 5v14l11-7z"/></svg>
        </div>
    </div>

    <div class="full-player" id="fullPlayer">
        <div class="fp-bg" id="fp-bg"></div>
        
        <div class="fp-header">
            <svg onclick="closePlayer()" viewBox="0 0 24 24"><path d="M15.957 2.793a1 1 0 010 1.414L8.164 12l7.793 7.793a1 1 0 11-1.414 1.414L5.336 12l9.207-9.207a1 1 0 011.414 0z" transform="rotate(-90 12 12)"/></svg>
            <div class="fp-header-text"><span id="fp-context-label">WIEDERGABE AUS PLAYLIST</span><b id="fp-context">Deine Bibliothek</b></div>
            <svg viewBox="0 0 24 24"><path d="M12 3a2 2 0 100 4 2 2 0 000-4zm0 7a2 2 0 100 4 2 2 0 000-4zm0 7a2 2 0 100 4 2 2 0 000-4z"/></svg>
        </div>

        <div class="fp-image-container">
            <div class="video-toggle-pill" id="video-toggle-btn" onclick="toggleVideoAudio()">Zu Audio wechseln</div>
            <img id="fp-cover-img" src="">
            <div id="yt-player-placeholder"></div>
        </div>

        <div class="fp-track-info">
            <div style="flex:1; overflow:hidden; padding-right:15px;">
                <h2 class="fp-title" id="fp-title">Titel</h2>
                <p class="fp-artist" id="fp-artist">Artist</p>
            </div>
            <svg class="fp-check" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor"/><path d="M10 16l-4-4 1.41-1.41L10 13.17l6.59-6.59L18 8l-8 8z" fill="#000"/></svg>
        </div>

        <div class="fp-progress-container">
            <input type="range" class="fp-slider" id="fp-slider" value="0" min="0" max="100" onchange="seekTo(this.value)">
            <div class="fp-time"><span id="fp-time-current">0:00</span><span id="fp-time-total">0:00</span></div>
        </div>

        <div class="fp-controls">
            <svg viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
            <svg onclick="prevTrack()" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            <div class="play-pause" onclick="togglePlay(event)">
                <svg id="fp-play-btn" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
            <svg onclick="nextTrack()" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
            <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchView('start', this)">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Start
        </div>
        <div class="nav-item" onclick="switchView('search', this)">
            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>Suchen
        </div>
        <div class="nav-item" onclick="switchView('library', this)">
            <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12zM10 9h8v2h-8zm0 3h4v2h-4zm0-6h8v2h-8z"/></svg>Bibliothek
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="bs-overlay" onclick="closePlusMenu()">
        <div class="bottom-sheet" id="bs-menu" onclick="event.stopPropagation()">
            <div class="bs-handle"></div>
            <div class="bs-item" onclick="openCreatePlaylist()">
                <div class="bs-icon">
                    <svg viewBox="0 0 24 24"><path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/></svg>
                </div>
                <div class="bs-text">
                    <h4>Playlist</h4>
                    <p>Erstelle eine Playlist mit Songs oder Folgen.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="create-playlist-screen" id="create-playlist-view">
        <h2 class="cp-header">Give your playlist a name</h2>
        <div class="cp-input-container">
            <input type="text" id="new-playlist-input" class="cp-input" value="My playlist #18">
        </div>
        <div class="cp-buttons">
            <button class="cp-btn-cancel" onclick="closeCreatePlaylist()">Cancel</button>
            <button class="cp-btn-create" onclick="confirmPlaylistCreation()">Create</button>
        </div>
    </div>

    <div class="popup-overlay" id="custom-popup">
        <div class="popup-box">
            <h3 class="popup-title" id="popup-title">Bist du sicher?</h3>
            <p class="popup-text" id="popup-text">Nach dem Speichern kannst du keine Änderungen mehr an diesem Design vornehmen.</p>
            <button class="popup-btn-primary" id="popup-btn-yes" onclick="executePopupAction()">Speichern</button>
            <button class="popup-btn-secondary" onclick="closePopup()">Abbrechen</button>
        </div>
    </div>

<script>
    // --- DATEN & STATE ---
    
    // Startseite: 8 Grid Items wie im Screenshot
    const startItems = [
        { title: "Chill-Mix 2025", img: "https://i.scdn.co/image/ab67706c0000da8490a1e35d038dc79860b2f518", ytId: "jfKfPfyJRdk" },
        { title: "Lieblingssongs", img: "https://t.scdn.co/images/3099b3803ad9496896c43f22fe9be8c4.png", ytId: "9oD5M_yN1H0" },
        { title: "#268 - KI übernimmt in 2...", img: "https://i.scdn.co/image/ab6765630000ba8a7c1b181e1945f7435f30691e", ytId: "b8I-7Wk_Vbc" },
        { title: "Playlist.", img: "https://i.scdn.co/image/ab67706c0000da84e7235ce461dcd8a1130dcf23", ytId: "4NRXx6U8ABQ" },
        { title: "Techq Quest | Music Playlist", img: "https://i.scdn.co/image/ab67706c0000da845763b022b72cb1a1532f1f00", ytId: "ALZHF5UqnU4" },
        { title: "Best EDM Songs", img: "https://i.scdn.co/image/ab67706c0000da84bf41d4c22cc5cba5701ce1f6", ytId: "fKopy74weus" },
        { title: "JBL Bass Boosted", img: "https://i.scdn.co/image/ab67706c0000da84c478a05c75abfba6af2097e3", ytId: "4NRXx6U8ABQ" },
        { title: "JBL BassBoosted", img: "https://i.scdn.co/image/ab67706c0000da8444a56977df76f4afec939029", ytId: "jfKfPfyJRdk" }
    ];

    // Startseite: Podcast / Video Feed darunter
    const feedItems = [
        { 
            channelIcon: "https://yt3.ggpht.com/ytc/AIdro_k6p6t22yQz7rL-GZ96U1g8hW2qX4J7L2Q_uX8F=s68-c-k-c0x00ffffff-no-rj",
            channelName: "MrWissen2go",
            metaInfo: "100.000+ plays • 12. Feb.",
            title: "Die Epstein-Files: Wer steht drin?",
            subtitle: "Komplette Folge ansehen",
            cover: "https://img.youtube.com/vi/b8I-7Wk_Vbc/maxresdefault.jpg",
            ytId: "b8I-7Wk_Vbc"
        },
        { 
            channelIcon: "https://yt3.ggpht.com/ytc/AIdro_nL7D0wJ3Wv-1Ww_QnZ1nL11n-0o6v7XwW_K4w_9w=s68-c-k-c0x00ffffff-no-rj",
            channelName: "Tom Supreme",
            metaInfo: "50.000+ plays • vor 5 Tagen",
            title: "Wie Kriminell ist die JUGEND an Karneval? | Verhaftung | Tom Supr...",
            subtitle: "Komplette Folge ansehen",
            cover: "https://img.youtube.com/vi/S_Y2lO0q1_A/maxresdefault.jpg",
            ytId: "S_Y2lO0q1_A"
        }
    ];

    // Bibliothek: Deine persönlichen Speicherungen (wie im Screenshot)
    let myLibrary = [
        { title: "Wissen mit Johnny", artist: "Podcast • Johnny", type: "yt", ytId: "2nB12QYnB8k", imgType: "square", isGreen: false, pinned: true },
        { title: "My top tracks playlist", artist: "Playlist • Patrick", type: "yt", ytId: "4NRXx6U8ABQ", imgType: "square", isGreen: false, pinned: false },
        { title: "Chill-Mix 2025", artist: "Gemixte Playlist • Patrick", type: "yt", ytId: "jfKfPfyJRdk", imgType: "square", isGreen: true, pinned: false },
        { title: "{ungeskriptet} - Gespräche...", artist: "Podcast • Ben Berndt", type: "yt", ytId: "S_Y2lO0q1_A", imgType: "square", isGreen: false, pinned: false },
        { title: "extrembequem", artist: "Podcast • extrembequem", type: "yt", ytId: "b8I-7Wk_Vbc", imgType: "square", isGreen: false, pinned: false },
        { title: "Playlist.", artist: "Gemixte Playlist • Patrick", type: "yt", ytId: "9oD5M_yN1H0", imgType: "square", isGreen: false, pinned: false },
        { title: "Lieblingssongs", artist: "Playlist • 140 Songs", type: "yt", ytId: "V1Pl8CzNzCw", imgType: "square", isGreen: false, pinned: false }
    ];

    let ytPlayer, audioPlayer = document.getElementById('native-audio');
    let currentMode = 'yt', isPlaying = false, progressInterval;
    let isVideoVisible = true;

    const playIcon = '<path d="M8 5v14l11-7z"/>';
    const pauseIcon = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
    const pinSVG = '<svg class="pin-icon" viewBox="0 0 24 24"><path d="M16 12V4h1V2H7v2h1v8l-2 2v2h5v6l1 1 1-1v-6h5v-2l-2-2z"/></svg>';

    // --- INITIALISIERUNG ---
    function onYouTubeIframeAPIReady() {
        ytPlayer = new YT.Player('yt-player-placeholder', {
            height: '100%', width: '100%', videoId: '',
            playerVars: { 'autoplay': 0, 'controls': 0, 'disablekb': 1, 'fs': 0, 'modestbranding': 1, 'playsinline': 1 },
            events: { 'onStateChange': onPlayerStateChange }
        });
    }

    function onPlayerStateChange(event) {
        if(currentMode !== 'yt') return;
        if (event.data == YT.PlayerState.PLAYING) {
            isPlaying = true; updatePlayButtons(pauseIcon); startProgressBar();
            document.getElementById('fp-slider').max = ytPlayer.getDuration();
            document.getElementById('fp-time-total').innerText = formatTime(ytPlayer.getDuration());
        } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) {
            isPlaying = false; updatePlayButtons(playIcon); clearInterval(progressInterval);
        }
    }

    audioPlayer.addEventListener('play', () => { isPlaying = true; updatePlayButtons(pauseIcon); startProgressBar(); });
    audioPlayer.addEventListener('pause', () => { isPlaying = false; updatePlayButtons(playIcon); clearInterval(progressInterval); });
    audioPlayer.addEventListener('loadedmetadata', () => { document.getElementById('fp-slider').max = audioPlayer.duration; document.getElementById('fp-time-total').innerText = formatTime(audioPlayer.duration); });

    // --- RENDER VIEWS ---
    function renderApp() {
        // Startseite: Grid
        const grid = document.getElementById('start-grid-container');
        grid.innerHTML = startItems.map(item => `
            <div class="grid-item" onclick="playCustom('yt', '${item.ytId}', '${item.title}', 'Playlist')">
                <img src="${item.img}"><span>${item.title}</span>
            </div>
        `).join('');

        // Startseite: Feed Section
        const feedContainer = document.getElementById('recommendations-container');
        feedContainer.innerHTML = feedItems.map(item => `
            <div class="feed-item" onclick="playCustom('yt', '${item.ytId}', '${item.title}', '${item.channelName}')">
                <div class="feed-header">
                    <img src="${item.channelIcon}">
                    <div class="feed-header-info">
                        <h4>${item.title}</h4>
                        <p>${item.channelName} • ${item.metaInfo}</p>
                    </div>
                </div>
                <div class="feed-content">
                    <div style="position:relative;">
                        <img src="${item.cover}">
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.7); color:white; padding:8px 16px; border-radius:20px; font-size:14px; font-weight:600;">${item.subtitle}</div>
                    </div>
                    <div class="feed-actions">
                        <div class="feed-actions-left">
                            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            <svg viewBox="0 0 24 24"><path d="M12 8v4l3 3-1.41 1.41L10 12.59V8h2zm10 4c0 5.52-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2s10 4.48 10 10zm-2 0c0-4.42-3.58-8-8-8s-8 3.58-8 8 3.58 8 8 8 8-3.58 8-8z"/></svg>
                            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        </div>
                        <div class="feed-play-btn"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                    </div>
                </div>
            </div>
        `).join('');

        // Bibliothek: Eigene Speicherungen
        const libList = document.getElementById('library-list');
        libList.innerHTML = myLibrary.map(item => {
            const imgUrl = item.img || `https://img.youtube.com/vi/${item.ytId}/hqdefault.jpg`;
            const titleClass = item.isGreen ? 'list-title green' : 'list-title';
            const pinHtml = item.pinned ? pinSVG : '';
            return `
                <div class="list-item ${item.imgType}" onclick="playCustom('yt', '${item.ytId}', '${item.title}', '${item.artist}')">
                    <img src="${imgUrl}">
                    <div class="list-info">
                        <div class="${titleClass}">${item.title}</div>
                        <div class="list-subtitle">${pinHtml}${item.artist}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // --- NAVIGATION & MENÜS ---
    function switchView(viewId, element) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        if(element) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); element.classList.add('active'); }
    }

    function openPlusMenu() {
        document.getElementById('bs-overlay').classList.add('active');
        setTimeout(() => document.getElementById('bs-menu').classList.add('active'), 10);
    }
    function closePlusMenu() {
        document.getElementById('bs-menu').classList.remove('active');
        setTimeout(() => document.getElementById('bs-overlay').classList.remove('active'), 300);
    }

    // --- CREATE PLAYLIST SCREEN ---
    function openCreatePlaylist() {
        closePlusMenu();
        document.getElementById('create-playlist-view').classList.add('active');
    }
    function closeCreatePlaylist() {
        document.getElementById('create-playlist-view').classList.remove('active');
    }
    function confirmPlaylistCreation() {
        const name = document.getElementById('new-playlist-input').value;
        showPopup(
            "Bist du sicher?", 
            "Nach dem Speichern kannst du keine Änderungen mehr an diesem Design vornehmen.", 
            "Speichern", 
            () => {
                myLibrary.unshift({ title: name, artist: "Playlist • Patrick", type: "yt", ytId: "9oD5M_yN1H0", imgType: "square", isGreen: false, pinned: false });
                renderApp();
                closeCreatePlaylist();
            }
        );
    }

    // --- POPUP SYSTEM ---
    let pendingPopupAction = null;
    function showPopup(title, text, primaryBtnText, onConfirm) {
        document.getElementById('popup-title').innerText = title;
        document.getElementById('popup-text').innerText = text;
        document.getElementById('popup-btn-yes').innerText = primaryBtnText;
        pendingPopupAction = onConfirm;
        document.getElementById('custom-popup').classList.add('active');
    }
    function closePopup() {
        document.getElementById('custom-popup').classList.remove('active');
        pendingPopupAction = null;
    }
    function executePopupAction() {
        if(pendingPopupAction) pendingPopupAction();
        closePopup();
    }

    // --- SUCHEN & ITUNES API ---
    let searchTimeout = null;
    function performSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            const query = document.getElementById('searchInput').value.trim();
            if(!query) { document.getElementById('search-local-results').innerHTML = ''; document.getElementById('search-itunes-results').innerHTML = 'Tippe etwas ein...'; return; }

            const localFilter = myLibrary.filter(i => i.title.toLowerCase().includes(query.toLowerCase()));
            document.getElementById('search-local-results').innerHTML = localFilter.length ? localFilter.map(item => `
                <div class="list-item" onclick="playCustom('yt', '${item.ytId}', '${item.title}', '${item.artist}')">
                    <img src="https://img.youtube.com/vi/${item.ytId}/hqdefault.jpg" style="border-radius:4px;">
                    <div class="list-info"><div class="list-title">${item.title}</div><div class="list-subtitle">Lokal</div></div>
                </div>`).join('') : '<p style="color:#a7a7a7; padding:0 15px;">Nichts in deiner Bibliothek gefunden.</p>';

            document.getElementById('search-itunes-results').innerHTML = 'Sucht nach Podcasts...';
            fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&media=podcast&entity=podcastEpisode&limit=6`)
                .then(res => res.json())
                .then(data => {
                    const c = document.getElementById('search-itunes-results');
                    c.innerHTML = data.results.length ? data.results.map(ep => `
                        <div class="list-item" onclick="playCustom('audio', '${ep.episodeUrl}', '${ep.trackName.replace(/'/g, "\\'")}', '${ep.collectionName.replace(/'/g, "\\'")}', '${ep.artworkUrl160}')">
                            <img src="${ep.artworkUrl160}" style="border-radius:8px;">
                            <div class="list-info"><div class="list-title">${ep.trackName}</div><div class="list-subtitle">iTunes Podcast</div></div>
                        </div>`).join('') : '<p style="color:#a7a7a7; padding:0 15px;">Keine Podcasts gefunden.</p>';
                });
        }, 500);
    }

    // --- PLAYER & VIDEO/AUDIO TOGGLE ---
    function playCustom(type, srcOrId, title, artist, img) {
        currentMode = type;
        if(type === 'yt') {
            audioPlayer.pause();
            if(ytPlayer && ytPlayer.loadVideoById) ytPlayer.loadVideoById(srcOrId);
        } else if(type === 'audio') {
            if(ytPlayer && ytPlayer.pauseVideo) ytPlayer.pauseVideo();
            audioPlayer.src = srcOrId; audioPlayer.play();
        }

        const coverUrl = img || (type === 'yt' ? `https://img.youtube.com/vi/${srcOrId}/hqdefault.jpg` : '');

        document.getElementById('miniPlayer').style.display = 'flex';
        document.getElementById('mini-title').innerText = title; document.getElementById('mini-artist').innerText = artist; document.getElementById('mini-img').src = coverUrl;

        document.getElementById('fp-title').innerText = title; document.getElementById('fp-artist').innerText = artist;
        document.getElementById('fp-bg').style.backgroundImage = `url('${coverUrl}')`;
        document.getElementById('fp-cover-img').src = coverUrl;
        document.getElementById('fp-context-label').innerText = type === 'audio' ? 'PODCAST EPISODE' : 'PLAYLIST SONG';

        const toggleBtn = document.getElementById('video-toggle-btn');
        if(type === 'yt') {
            toggleBtn.style.display = 'block';
            isVideoVisible = true;
            document.getElementById('yt-player-placeholder').style.opacity = '1';
            toggleBtn.innerText = 'Zu Audio wechseln';
        } else {
            toggleBtn.style.display = 'none';
        }

        updatePlayButtons(pauseIcon);
    }

    function toggleVideoAudio() {
        if(currentMode !== 'yt') return;
        isVideoVisible = !isVideoVisible;
        const ytView = document.getElementById('yt-player-placeholder');
        const toggleBtn = document.getElementById('video-toggle-btn');
        
        if(isVideoVisible) {
            ytView.style.opacity = '1';
            toggleBtn.innerText = 'Zu Audio wechseln';
        } else {
            ytView.style.opacity = '0';
            toggleBtn.innerText = 'Zu Video wechseln';
        }
    }

    function togglePlay(e) {
        if(e) e.stopPropagation();
        if(currentMode === 'yt') {
            if(!ytPlayer || !ytPlayer.getPlayerState) return;
            ytPlayer.getPlayerState() == YT.PlayerState.PLAYING ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
        } else {
            audioPlayer.paused ? audioPlayer.play() : audioPlayer.pause();
        }
    }

    function updatePlayButtons(svg) { document.getElementById('mini-play-btn').innerHTML = svg; document.getElementById('fp-play-btn').innerHTML = svg; }

    function startProgressBar() {
        clearInterval(progressInterval);
        progressInterval = setInterval(() => {
            let t = 0;
            if(currentMode === 'yt' && ytPlayer && ytPlayer.getCurrentTime) t = ytPlayer.getCurrentTime();
            else if (currentMode === 'audio') t = audioPlayer.currentTime;
            document.getElementById('fp-slider').value = t; document.getElementById('fp-time-current').innerText = formatTime(t);
        }, 500);
    }

    function seekTo(s) { currentMode === 'yt' && ytPlayer ? ytPlayer.seekTo(s, true) : audioPlayer.currentTime = s; }
    function formatTime(s) { if(isNaN(s)) return "0:00"; s = Math.round(s); return Math.floor(s/60) + ":" + ((s%60)<10?"0":"") + (s%60); }
    function openPlayer() { document.getElementById('fullPlayer').classList.add('active'); }
    function closePlayer() { document.getElementById('fullPlayer').classList.remove('active'); }
    function prevTrack() { seekTo(0); }
    function nextTrack() { alert("Nächster Track"); }

    renderApp();
</script>
</body>
</html>
